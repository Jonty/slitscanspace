<head>
    <title>S L I T S C A N S P A C E</title>
    <style>
        body,html{ margin:0 }
        canvas { width:100%; height:100% }
	video { display: none }
    </style>
    <script type="text/javascript">
	    function slitscan() {

		// from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia
		// Older browsers might not implement mediaDevices at all, so we set an empty object first
		if (navigator.mediaDevices === undefined) {
		    navigator.mediaDevices = {};
		}

		// Some browsers partially implement mediaDevices. We can't just assign an object
		// with getUserMedia as it would overwrite existing properties.
		// Here, we will just add the getUserMedia property if it's missing.
		if (navigator.mediaDevices.getUserMedia === undefined) {
		    navigator.mediaDevices.getUserMedia = function(constraints) {

			// First get ahold of the legacy getUserMedia, if present
			var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

			// Some browsers just don't implement it - return a rejected promise with an error
			// to keep a consistent interface
			if (!getUserMedia) {
			    return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
			}

			// Otherwise, wrap the call to the old navigator.getUserMedia with a Promise
			return new Promise(function(resolve, reject) {
			    getUserMedia.call(navigator, constraints, resolve, reject);
			});
		    };
		};

		var canvas = document.getElementById('canvas');
		var video = document.getElementById('video')
		var ctx = canvas.getContext('2d');

		var ctx = canvas.getContext("2d");
		ctx.font = "30px Helvetica";
		ctx.textAlign = "center";
		ctx.strokeText("S L I T S C A N S P A C E",canvas.width/2, canvas.height/2);
		ctx.strokeText("by @jonty",canvas.width/2, (canvas.height/4)*3);

		function getWebcam(){
			window.navigator.mediaDevices.getUserMedia({video: true, audio: false}).then(function(stream) {
			    if ("srcObject" in video) {
				video.srcObject = stream;
			    } else {
				video.src = window.URL.createObjectURL(stream);
			    }
			    video.play()
			}).catch(function(e) {
				alert("Oh no, I failed to access your webcam :(");
				console.error('Failed to get webcam stream', e);
			});
		}

		var loopFrame
		function loop(){
			loopFrame = requestAnimationFrame(loop);
			var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
			ctx.putImageData(imageData, -1, 0);
			ctx.drawImage(video, canvas.width-1, 0, 1, canvas.height);
		}

		function startLoop(){
			loopFrame = loopFrame || requestAnimationFrame(loop);
		}

		video.addEventListener('loadedmetadata',function(){
			startLoop();
		});

		getWebcam();
	    }
    </script>
</head>
<body onload="slitscan()">
    <canvas id="canvas" width="720" height="720"></canvas>
    <video id="video" playsinline muted></video>
</body>
